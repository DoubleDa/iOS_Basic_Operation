#计算机网络基础知识:

***

- OSI分层（7层）：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。
- TCP/IP分层（4层）：网络接口层、 网际层、运输层、 应用层。
- 五层协议（5层）：物理层、数据链路层、网络层、运输层、 应用层。

- 每一层的作用如下：
	- 物理层：通过媒介传输比特,确定机械及电气规范（比特Bit）
	- 数据链路层：将比特组装成帧和点到点的传递（帧Frame）
	- 网络层：负责数据包从源到宿的传递和网际互连（包PackeT）
	- 传输层：提供端到端的可靠报文传递和错误恢复（段Segment）
	- 会话层：建立、管理和终止会话（会话协议数据单元SPDU）
	- 表示层：对数据进行翻译、加密和压缩（表示协议数据单元PPDU）
	- 应用层：允许访问OSI环境的手段（应用协议数据单元APDU）

- TCP连接是全双工的
- TCP三次握手:
	- SYN_SEND: host1发送一个TCP标志位 SYN=1，ACK=0 的数据包给host2，并且会随机产生一个 sequence number = 3233。当host2接受到这个数据后，host2有 SYN=1 可知客户端是想要建立连接
	- SYN_RECEIVE: host2要对客户端的联机请求进行确认，向host1发送应答号ACK=1、SYN=1、确认号Acknowledge number=3234，此值是host1的序列号加1，还会产生一个随机的序列号Sequence number=36457，这样就告诉host1可以进行连接；
	- ESTABLISHED: host1收到数据后检查Acknowledge number是否是3233+1的值，以及ACK的值是否为1，若为1，host1会发送ACK=1、确认号码Acknowledge number=36457，告诉host2,你的请求连接被确认，连接可以建立。
	- SYN攻击：
        - 在三次握手过程中，Server发送SYN-ACK之后，收到Client的ACK之前的TCP连接称为半连接（half-open connect），此时Server处于SYN_RCVD状态，当收到ACK后，Server转入ESTABLISHED状态。SYN攻击就是Client在短时间内伪造大量不存在的IP地址，并向Server不断地发送SYN包，Server回复确认包，并等待Client的确认，由于源地址是不存在的，因此，Server需要不断重发直至超时，这些伪造的SYN包将产时间占用未连接队列，导致正常的SYN请求因为队列满而被丢弃，从而引起网络堵塞甚至系统瘫痪。SYN攻击时一种典型的DDOS攻击，检测SYN攻击的方式非常简单，即当Server上有大量半连接状态且源IP地址是随机的，则可以断定遭到SYN攻击了，使用如下命令可以让之现行：
        #netstat -nap | grep SYN_RECV

- TCP四次挥手: 断开连接的可以使Client，也可以是Server，现已Client为例说明,先发起中断请求。
	- 第一次挥手：Client向Server端发送FIN报文；用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。Server端收到报文，如果数据还没有发送完成,socket并不会立刻关闭，可以继续发送数据；
	- 第二次挥手：Server端向Client端先发送ACK，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号），Server进入CLOSE_WAIT状态。Client端收到报文进入FIN_Wait状态；
	- 第三次挥手：Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。
	- 第四次挥手：Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手。
	- 上面是一方主动关闭，另一方被动关闭的情况，实际中还会出现同时发起主动关闭的情况

- 为什么建立连接是三次握手，而关闭连接却是四次挥手呢？
    - 这是因为服务端在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，当收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，己方也未必全部数据都发送给对方了，所以己方可以立即close，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送。


- TCP/IP使用命令:
	- ping -t/-n/-w
		 - -t 使当前主机不断地向目的主机发送数据，直到使用Ctrl－C中断；
		 - -a  以IP地址格式（不是主机名形式）显示网络地址；
		 - -n
		 - -l
		 - -v
		 - -s
		 - -j
		 - -k
		 - -w
	- winipcfg(ipconfig/ifconfig): winipcfg和ipconfig都是用来显示主机内IP协议的配置信息。只是winipcfg适用于Windows 95/98，而ipconfig适用于Windows NT,ifconfig是在UNIX系统下
	- tracert: 判定数据包到达目的主机所经过的路径、显示数据包经过的中继节点清单和到达时间。tracert [-d] [-h maximum_hops] [-j host-list] [-w timeout] target_name 
	- netstat: 它可以显示当前正在活动的网络连接的详细信息，如采用的协议类型、当前主机与远端相连主机（一个或多个）的IP地址以及它们之间的连接状态等
	- arp: 用来显示及修改特定IP地址的网卡地址。arp的命令格式如下： arp -s inet_addr eth_addr [if_addr] arp -d inet_addr [if_addr] arp -a [inet_addr] [-N if_addr] 

- 浏览器访问页面HTTP协议返回状态码
	- 1xx-信息提示: 这些状态代码表示临时的响应。客户端在收到常规响应之前，应准备接收一个或多个1xx响应。
		 - 100-继续。 
		 - 101-切换协议。
	- 2xx-成功: 这类状态代码表明服务器成功地接受了客户端请求。 
		 - 200-确定。客户端请求已成功。 
		 - 201-已创建。 
		 - 202-已接受。 
		 - 203-非权威性信息。 
		 - 204-无内容。 
		 - 205-重置内容。 
		 - 206-部分内容。 
	- 3xx-重定向: 客户端浏览器必须采取更多操作来实现请求。例如，浏览器可能不得不请求服务器上的不同的页面，或通过代理服务器重复该请求。 
		 - 301-对象已永久移走，即永久重定向。 
		 - 302-对象已临时移动。 
		 - 304-未修改。 
		 - 307-临时重定向。 
	- 4xx-客户端错误: 发生错误，客户端似乎有问题。例如，客户端请求不存在的页面，客户端未提供有效的身份验证信息。
		 - 400: Bad Request(错误的请求)
		 - 401: Unauthorized(访问被拒绝。IIS定义了许多不同的401错误，它们指明更为具体的错误原因。这些具体的错误代码在浏览器中显示，但不在IIS日志中显示)
		 	 - 401.1-登录失败。 
			 - 401.2-服务器配置导致登录失败。 
			 - 401.3-由于ACL对资源的限制而未获得授权。 
			 - 401.4-筛选器授权失败。 
			 - 401.5-ISAPI/CGI应用程序授权失败。 
			 - 401.7–访问被Web服务器上的URL授权策略拒绝。这个错误代码为IIS6.0所专用。 
		 - 402: Payment Required(预留接口)
		 - 403: Forbidden(禁止访问：IIS定义了许多不同的403错误，它们指明更为具体的错误原因：)
		 	 - 403.1-执行访问被禁止。 
			 - 403.2-读访问被禁止。 
			 - 403.3-写访问被禁止。 
			 - 403.4-要求SSL。 
			 - 403.5-要求SSL128。 
			 - 403.6-IP地址被拒绝。 
			 - 403.7-要求客户端证书。 
			 - 403.8-站点访问被拒绝。 
			 - 403.9-用户数过多。 
			 - 403.10-配置无效。 
			 - 403.11-密码更改。 
			 - 403.12-拒绝访问映射表。 
			 - 403.13-客户端证书被吊销。 
			 - 403.14-拒绝目录列表。 
			 - 403.15-超出客户端访问许可。 
			 - 403.16-客户端证书不受信任或无效。 
			 - 403.17-客户端证书已过期或尚未生效。 
			 - 403.18-在当前的应用程序池中不能执行所请求的URL。这个错误代码为IIS6.0所专用。 
			 - 403.19-不能为这个应用程序池中的客户端执行CGI。这个错误代码为IIS6.0所专用。 
			 - 403.20-Passport登录失败。这个错误代码为IIS6.0所专用。 
		 - 404: Not Found(未找到)
		 	 - 404.0-（无）–没有找到文件或目录。 
			 - 404.1-无法在所请求的端口上访问Web站点。 
			 - 404.2-Web服务扩展锁定策略阻止本请求。 
			 - 404.3-MIME映射策略阻止本请求。 
		 - 405: Method Not Allowed(用来访问本页面的HTTP谓词不被允许（方法不被允许）)
		 - 406-客户端浏览器不接受所请求页面的MIME类型。 
		 - 407-要求进行代理身份验证。 
		 - 412-前提条件失败。 
		 - 413–请求实体太大。 
		 - 414-请求URI太长。 
		 - 415–不支持的媒体类型。 
		 - 416–所请求的范围无法满足。 
		 - 417–执行失败。 
		 - 423–锁定的错误。
	- 5xx-服务器错误: 服务器由于遇到错误而不能完成该请求。  
		 - 500-内部服务器错误。 
		 	 - 500.12-应用程序正忙于在Web服务器上重新启动。 
		 	 - 500.13-Web服务器太忙。 
			 - 500.15-不允许直接请求Global.asa。 
			 - 500.16–UNC授权凭据不正确。这个错误代码为IIS6.0所专用。 
			 - 500.18–URL授权存储不能打开。这个错误代码为IIS6.0所专用。 
			 - 500.100-内部ASP错误。 
		 - 501-页眉值指定了未实现的配置。 
		 - 502-Web服务器用作网关或代理服务器时收到了无效响应。 
			 - 502.1-CGI应用程序超时。 
			 - 502.2-CGI应用程序出错。application. 
		 - 503-服务不可用。这个错误代码为IIS6.0所专用。服务器繁忙
		 - 504-网关超时。 
		 - 505-HTTP版本不受支持。
		 
- 集线器，交换机，路由器比较
	 - 路由器与交换机
		 - 路由器工作在网络层，交换机工作在数据链路层；
		 - 路由器根据IP地址进行数据的转发，交换机根据MAC地址进行数据转发；
		 - 此外，路由器中还多了防火墙的功能
	 - 集线器与交换机
		 - 集线器是共享式，交换机是独享式
	 - 集线器与路由器
		 - 集线器工作在数据链路层，路由器工作在网络层，是互联网的主要骨干
		 
	 > 路由器主要用于家庭局域网，交换机主要常见于宿舍上网分配中，集线器主要用于组建星型局域网等网络拓扑中

- 各种通信协议:
	- 物理层:
		 * CLOCK
		 * RJ45
		 * IEEE802.3
		 * 中继器，集线器，网关
	- 数据链路层:
		 * PPP
		 * FR
		 * HDLC
		 * VLAN
		 * MAC
		 * 网桥，交换机
	- 网络层(IP): IPv4/IPv6

		 > IPv4有2^32 -1个IP地址;IPv6有2^128 -1个IP地址:
		    1. 更大的存储空间;
		    2. 更小的路由表;
		    3. 增强的组播;
		    4. 加入了对自动配置的支持；

		 * ICMP(Internet Control Message Protocol): 补充IP传输数据报的过程中，发送主机无法确定数据报是否到达目标主机
			   * 出错报文: 若数据报不能到达目标主机，ICMP出错报告报文可以以回送信息的方式，向源主机发去信息，并不能纠正数据报中的任何出错
			   * 查询报文: ICMP还可以诊断出某些网络问题，这就是ICMP的查询报文。
		 * IGMP(Internet Group Management Protocol): 主要用于建立和管理多播组，对IP分组广播进行控制。

		 > Compare:
			internet控制消息协议ICMP是用于报告错误并代表IP对消息进行控制。IP运用互联组管理协议IGMP来告诉路由器，某一网络上指导组中的可用主机。ICMP源抑制消息：当TCP/IP主机发送数据到另一主机时，如果速度达到路由器或者链路的饱和状态，路由器发出一个ICMP源抑制消息。

		 * ARP: 从路由表获取主机Mac地址
		 * RARP: Mac地址通过路由表反向获得IP地址
		 * RIP:
		 * IPX:
		 * IGRP
		 * OSPF(Open Shortest Path First开放式最短路径优先)是一个内部网管协议(,IGP)
		 	 - 是IETF组织开发的一个基于链路状态的内部网关协议(InteriorGatewayProtocol IGP)，作为基于链路状态的协议，具有收敛快、路由无环、可扩展等优点，成为优秀的内部网关协议被快速接收并广泛使用。
		 	 - 根据路由器所连接的物理网络不同，OSPF将网络划分为四种类型：广播多路访问型（Broadcast multiAccess）、非广播多路访问型（None Broadcast MultiAccess，NBMA）、点到点型（Point-to-Point）、点到多点型（Point-to-MultiPoint）。 
		 * 路由器
	- 传输层:
		 - TCP
		 - UDP
		 - SPX
	- 表示层协议：
		 - JPEF
		 - MPEG
		 - ASII 
	- 会话层协议：
		 - NFS
		 - SQL
		 - RPC	
	- 应用层:
		- BGP
		- FTP
		- TELNET
		- HTTP
		- SMTP ->MIME
		- SNMP
		- TFTP
		- DNS
		- BOOTP
		- DHCP
		- WWW
		- NFS

	- NTP SNTP区别: SNTP 其实是 NTP 的子集，只是 NTP 可以 分发和授时，而 SNTP 只有授时没有分发，也就是说你只能从 SNTP 获取时间，其他的什么都做不了， SNTP 简化了 NTP 的全部流程，这样节约成本，但只能同步一个时间源。精度上没什么差别。速度上 SNTP 可能快点。。

- IP网络数据传输
	- 单播(Unicast): 一对一
		- 单播在网络中得到了广泛的应用，网络上绝大部分的数据都是以单播的形式传输的，只是一般网络用户不知道而已。例如，你在收发电子邮件、浏览网页时，必须与邮件服务器、Web服务器建立连接，此时使用的就是单播数据传输方式。但是通常使用“点对点通信”（PointtoPoint）代替“单播”，因为“单播”一般与“多播”和“广播”相对应使用。

		> 点对点连接是两个系统或进程之间的专用通信链路。想象一下直接连接两个系统的一条线路。两个系统独占此线路进行通信。点对点通信的对立面是广播在广播通信中一个系统可以向多个系统传输。Unicast(单播):在客户端与媒体服务器之间需要建立一个单独的数据通道，从一台服务器送出的每个数据包只能传送给一个客户机,这种传送方式称为单播。

	- 组播/多播(Multicast):(一个人向多个人（但不是在场的所有人）说话)
		- 提高通话的效率。如果你要通知特定的某些人同一件事情，但是又不想让其他人知道，使用电话一个一个地通知就非常麻烦，而使用日常生活的大喇叭进行广播通知，就达不到只通知个别人的目的了，此时使用“多播”来实现就会非常方便快捷，但是现实生活中多播设备非常少。

	- 广播(Broadcast):一对所有
		- 网络对其中每一台主机发出的信号都进行无条件复制并转发，所有主机都可以接收到所有信息（不管你是否需要），由于其不用路径选择，所以其网络成本可以很低廉。有线电视网就是典型的广播型网络，我们的电视机实际上是接受到所有频道的信号，但只将一个频道的信号还原成画面。在数据网络中也允许广播的存在，但其被限制在二层交换机的局域网范围内，禁止广播数据穿过路由器，防止广播数据影响大面积的主机。

- IP地址:(网络号(Network ID)，主机号(Host ID)) 4字节
	- 子网掩码(Subnet Masks):用来区分网络上的主机是否在同一网络取段内
		 - Class A : 255.0.0.0
		 - Class B : 255.255.0.0
		 - Class C : 255.255.255.0

		 > 当地址的所有主机位都为"0"时，这一地址为线路（或子网）地址，而当所有主机位都为"1"时为广播地址。

		 - The Subnet Masks of Class C :
		 	 - 255.255.255.0	子网位数: 0	主机数: 256	可用主机数: 254	
		 	 - 255.255.255.128	子网位数: 1	主机数: 128	可用主机数: 126	
		 	 - 255.255.255.192	子网位数: 2	主机数: 64	可用主机数: 62
		 	 - 255.255.255.224	子网位数: 3 	主机数: 32	可用主机数: 30
		 	 - 255.255.255.240	子网位数: 4	主机数: 16	可用主机数: 14
		 	 - 255.255.255.248	子网位数: 5	主机数: 8		可用主机数: 6
		 	 - 255.255.255.252	子网位数: 6	主机数: 4		可用主机数: 2

	- 实际应用中，可能会有多个分布与各地的网络，而且，每个网络的主机数量并不很多，如果申请多个NETWORKID，会造成IP资源的浪费，而且很不经济，如果我们在SUBNET MASKS上动一下手脚，可以在只申请一个NETWORK ID的基础上解决这个问题

	> 如果将子网掩码设置过大，也就是说子网范围扩大。那么根据子网寻径规则，很可能发往和本地机不在同一子网内的目的机的数据，会因为错误的相与结果而认为是在同一子网内，那么，数据包将在本子网内循环，直到超时并抛弃。数据不能正确到达目的机，导致网络传输错误。如果将子网掩码设置得过小，那么就会将本来属于同一子网内的机器之间的通信当做是跨子网传输，数据包都交给缺省网关处理，这样势必增加缺省网关的负担，造成网络效率下降。因此，任意设置子网掩码是不对的，应该根据网络管理部门的规定进行设置。如子网掩码的位数越多，能划分的子网数也就越多，但是每个子网的主机数就会越少。子网掩码的划分设置也有一个缺点：划分的子网越多，损失的IP地址也会越多。因为每个子网都会保留全0或全1的两个地址而不能使用。



